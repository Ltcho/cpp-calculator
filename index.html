<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Award Deal Analyzer - Combined</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;background:#FFFBED;min-height:100vh;padding:20px}
    .container{max-width:900px;margin:0 auto}
    h1{color:#004449;text-align:center;margin-bottom:10px;font-size:2.5rem;font-weight:700}
    .subtitle{color:#004449;text-align:center;margin-bottom:30px;font-size:1.1rem;opacity:.8}
    .card{background:#fff;border-radius:20px;padding:30px;margin-bottom:20px;box-shadow:0 10px 40px rgba(0,68,73,.1);border:2px solid #004449}
    .form-group{margin-bottom:20px}
    label{display:block;margin-bottom:8px;color:#004449;font-weight:600;font-size:14px}
    input,select{width:100%;padding:12px;border:2px solid #004449;border-radius:10px;font-size:16px;transition:border-color .3s;background:#fff}
    input:focus,select:focus{outline:none;border-color:#483CFF}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .form-row-triple{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}
    button{background:#483CFF;color:#fff;padding:14px 28px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .3s,box-shadow .3s;width:100%}
    button:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(72,60,255,.3)}
    .results-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;display:none}
    .result-card{padding:20px;border-radius:15px;text-align:center}
    .deal-quality{background:#fff;border:2px solid #004449}
    .deal-quality.good{background:#D7FFC2;border-color:#4ade80}
    .deal-quality.bad{background:#ffcccc;border-color:#ef4444}
    .cpp-value-card{background:#004449;color:#fff}
    .metric-label{font-size:.9rem;opacity:.9;margin-bottom:5px}
    .metric-value{font-size:2rem;font-weight:700;margin-bottom:5px}
    .metric-rating{font-size:1rem}
    .warning-list{text-align:left;margin-top:10px;padding-left:20px;font-size:.9rem;color:#004449}
    .recommendation{margin-top:20px;padding:20px;border-radius:15px;text-align:center;font-size:1.1rem;display:none}
    .recommendation.strong-yes{background:#D7FFC2;color:#004449;border:2px solid #4ade80}
    .recommendation.yes{background:#e8f5e8;color:#004449;border:2px solid #4ade80}
    .recommendation.maybe{background:#ffeaa7;color:#004449;border:2px solid #fbbf24}
    .recommendation.no{background:#ffcccc;color:#004449;border:2px solid #ef4444}
    @media (max-width:768px){.form-row,.form-row-triple,.results-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>‚úàÔ∏è Award Deal Analyzer</h1>
    <p class="subtitle">Check deal quality and calculate CPP value in one place</p>

    <div class="card">
      <form id="combinedForm">
        <div class="form-row">
          <div class="form-group">
            <label for="origin">Origin Airport (US)</label>
            <input type="text" id="origin" placeholder="e.g., JFK" maxlength="3" required style="text-transform:uppercase;">
          </div>

          <div class="form-group">
            <label for="destination">Destination Region</label>
            <select id="destination" required>
              <option value="">Select Region</option>
              <option value="Europe">Europe</option>
              <option value="Asia">Asia</option>
              <option value="Oceania">Oceania</option>
              <option value="Africa">Africa</option>
              <option value="Southern America">Southern America</option>
            </select>
          </div>
        </div>

        <div class="form-row-triple">
          <div class="form-group">
            <label for="fareClass">Fare Class</label>
            <select id="fareClass" required>
              <option value="">Select Class</option>
              <option value="Economy">Economy</option>
              <option value="Premium Economy">Premium Economy</option>
              <option value="Business">Business</option>
              <option value="First">First</option>
            </select>
          </div>

          <div class="form-group">
            <label for="points">Points Required</label>
            <input type="text" id="points" inputmode="numeric" placeholder="e.g., 75,000" required>
          </div>

          <div class="form-group">
            <label for="taxes">Taxes & Fees ($)</label>
            <input type="text" id="taxes" inputmode="decimal" placeholder="e.g., 250.00" required>
          </div>
        </div>

        <div class="form-group">
          <label for="cashPrice">Cash Price ($) (optional)</label>
          <input type="text" id="cashPrice" inputmode="decimal" placeholder="What would this flight cost in cash?">
        </div>

        <button type="submit">Analyze Deal</button>
      </form>

      <div class="results-grid" id="resultsGrid">
        <div class="result-card deal-quality" id="dealQualityCard">
          <div class="metric-label">Deal Quality</div>
          <div class="metric-value" id="dealStatus">-</div>
          <div class="metric-rating" id="dealDetails">-</div>
          <ul class="warning-list" id="warningList"></ul>
        </div>

        <div class="result-card cpp-value-card" id="cppCard">
          <div class="metric-label" style="color:rgba(255,255,255,0.9)">CPP Value</div>
          <div class="metric-value" id="cppValue">‚Äî</div>
          <div class="metric-rating" id="cppRating">Add a cash price to calculate CPP</div>
        </div>
      </div>

      <div class="recommendation" id="recommendation"></div>
    </div>
  </div>

  <script>
    const CONFIG = {
      airports: {
        big: ["ATL","BOS","DFW","DTW","EWR","IAD","IAH","JFK","LAX","LGA","MIA","ORD","SFO"],
        medium: ["AUS","CLT","CLE","CVG","DEN","LAS","MCO","MSP","PDX","PHL","PHX","RDU","SAN","SEA","SLC","TPA"],
        small: ["ABE","ABQ","AEX","AUG","ALB","AMA","ANC","ASE","ATW","AVL","BDL","BGR","BHM","BIL","BLI","BMI","BNA","BOI","BTV","BUF","BUR","BWI","BZN","CAE","CAK","CHA","CHO","CHS","CID","CMH","CMI","COD","COS","CRP","CRW","CYS","DAB","DAL","DAY","DCA","DLH","DRO","DSM","ECP","EGE","ELP","EUG","EVV","EWN","EYW","FAI","FAR","FAT","FAY","FCA","FLL","FSD","FWA","GEG","GJT","GPT","GRB","GRR","GSO","GSP","GTF","GTR","GUM","HHH","HLN","HNL","HOU","HPN","HSV","HVN","ICT","ILM","IND","ISP","ITO","JAC","JAN","JAX","NYC","JLN","JNU","KOA","LBB","LCH","LEX","LGB","LIH","LIT","LNK","LRD","LYH","MAF","MCI","MDT","CHI","MEI","MEM","MFE","MFR","MGM","MHT","MKE","MLB","MLI","MOB","MOT","MQT","MSN","MSO","MSY","MTJ","MRY","MYR","OAK","OGG","OKC","OMA","ONT","ORF","ORH","PAE","PBI","PIA","PIT","PNS","PSC","PSP","PVD","PVU","PWM","RAP","RDD","RDM","RIC","RNO","ROA","ROC","RST","RSW","SAF","SAT","SAV","SBA","SBN","SDF","SCE","SGF","SHV","SJC","SJU","SMF","SNA","SRQ","STL","STS","STT","SUN","SUX","SWF","SYR","TLH","TUL","TUS","TVC","TWF","TYS","VPS","XNA","YUM"]
      },
      
      pointLimits: {
        "Big": {
          "Europe": {"Economy": 50000, "Premium Economy": 80000, "Business": 130000, "First": 160000},
          "Asia": {"Economy": 90000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Oceania": {"Economy": 90000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Africa": {"Economy": 80000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Southern America": {"Economy": 60000, "Premium Economy": 150000, "Business": 200000, "First": 240000}
        },
        "Medium": {
          "Europe": {"Economy": 70000, "Premium Economy": 80000, "Business": 140000, "First": 160000},
          "Asia": {"Economy": 100000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Oceania": {"Economy": 100000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Africa": {"Economy": 90000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Southern America": {"Economy": 80000, "Premium Economy": 150000, "Business": 200000, "First": 240000}
        },
        "Small": {
          "Europe": {"Economy": 70000, "Premium Economy": 80000, "Business": 140000, "First": 160000},
          "Asia": {"Economy": 100000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Oceania": {"Economy": 100000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Africa": {"Economy": 90000, "Premium Economy": 150000, "Business": 200000, "First": 240000},
          "Southern America": {"Economy": 90000, "Premium Economy": 150000, "Business": 200000, "First": 240000}
        }
      },
      
      taxCaps: {
        "Economy": 300,
        "Premium Economy": 600,
        "Business": 600,
        "First": 600
      },
      
      cppTiers: {
        POOR: { max: 1.0, label: 'Book with cash' },
        FAIR: { min: 1.0, max: 1.5, label: 'Fair ‚Äî cash usually better' },
        GOOD: { min: 1.5, max: 2.0, label: 'Good CPP' },
        EXCELLENT: { min: 2.0, label: 'Excellent CPP' }
      }
    };

    function getAirportSize(code) {
      const upperCode = (code || "").toUpperCase();
      if (CONFIG.airports.big.includes(upperCode)) return "Big";
      if (CONFIG.airports.medium.includes(upperCode)) return "Medium";
      if (CONFIG.airports.small.includes(upperCode)) return "Small";
      return null;
    }

    function stripNonNumeric(str, allowDecimal = false) {
      const regex = allowDecimal ? /[^0-9.]/g : /[^0-9]/g;
      let cleaned = (str || "").toString().replace(regex, "");
      
      if (allowDecimal && cleaned.includes(".")) {
        const parts = cleaned.split(".");
        cleaned = parts[0] + "." + parts.slice(1).join("");
      }
      
      return cleaned;
    }

    function formatWithCommas(str, allowDecimal = false) {
      const cleaned = stripNonNumeric(str, allowDecimal);
      if (!cleaned) return "";
      
      if (allowDecimal && cleaned.includes(".")) {
        const [intPart, decPart] = cleaned.split(".");
        return Number(intPart).toLocaleString() + "." + decPart;
      }
      
      return Number(cleaned).toLocaleString();
    }

    function parseFormattedNumber(str) {
      if (!str) return NaN;
      return parseFloat(str.toString().replace(/,/g, ""));
    }

    function attachNumberFormatter(input, allowDecimal = false) {
      input.addEventListener("input", () => {
        const caretPos = input.selectionStart || 0;
        const rawValue = input.value;
        const digitsBeforeCaret = rawValue.slice(0, caretPos).replace(/[^0-9]/g, "").length;
        input.value = formatWithCommas(rawValue, allowDecimal) || "";
        
        let digitsSeen = 0;
        let newCaretPos = input.value.length;
        
        for (let i = 0; i < input.value.length; i++) {
          if (/[0-9]/.test(input.value[i])) {
            digitsSeen++;
            if (digitsSeen >= digitsBeforeCaret) {
              newCaretPos = i + 1;
              break;
            }
          }
        }
        
        input.setSelectionRange(newCaretPos, newCaretPos);
      });

      input.addEventListener("paste", (e) => {
        e.preventDefault();
        const pastedText = (e.clipboardData || window.clipboardData).getData("text") || "";
        input.value = formatWithCommas(stripNonNumeric(pastedText, allowDecimal), allowDecimal);
        const endPos = input.value.length;
        input.setSelectionRange(endPos, endPos);
      });
    }

    function getCppTier(cpp) {
      if (cpp < CONFIG.cppTiers.POOR.max) return 'POOR';
      if (cpp < CONFIG.cppTiers.FAIR.max) return 'FAIR';
      if (cpp <= CONFIG.cppTiers.GOOD.max) return 'GOOD';
      return 'EXCELLENT';
    }

    function getRecommendation(meetsStandards, cppTier, highTaxes = false) {
      const recommendations = {
        good: {
          POOR: {
            class: 'maybe',
            text: 'üíµ <strong>Cash wins.</strong> This is a solid points redemption, but the cash price is even better. If you\'re set on using points, try booking through your credit card travel portal instead.'
          },
          FAIR: {
            class: 'maybe',
            text: 'üîÑ <strong>Cash beats points.</strong> The redemption is solid, but the cash price is better. Unless you\'re swimming in points (if so, lucky you!), you\'re better off paying in cash.'
          },
          GOOD: {
            class: 'yes',
            text: '‚úàÔ∏è <strong>Solid points deal.</strong> Book with points. This is a good redemption.'
          },
          EXCELLENT: {
            class: 'strong-yes',
            text: '‚ö° <strong>Book fast.</strong> This is a great points deal. Stop reading and start transferring.'
          }
        },
bad: {
  POOR: {
    class: 'no',
    text: '‚ùå <strong>Skip the redemption.</strong> This one\'s not worth your points. Book with cash, or if you\'re set on using points, check your credit card\'s travel portal for a better option.'
  },
  FAIR: {
    class: 'no',
    text: 'üí≥ <strong>Better deal in your credit card portal.</strong> Cash wins this time, but if you\'re set on using points, check out your credit card\'s travel portal.'
  },
  GOOD: {
    class: highTaxes ? 'yes' : 'maybe',
    text: highTaxes
      ? 'üü¢ <strong>Solid redemption.</strong> Taxes are a bit higher, but the overall value still makes this a great redemption.'
      : '‚è≥ <strong>Hold off for now.</strong> Both the cash and points prices are high. If you‚Äôve got time, set a price alert and wait for a better deal.'
  },
  EXCELLENT: {
    class: highTaxes ? 'yes' : 'maybe',
    text: highTaxes
      ? 'üü¢ <strong>Solid redemption.</strong> Taxes are a bit higher, but the overall value still makes this a great redemption.'
      : 'üìâ <strong>Wait for a price drop.</strong> Both the cash and points prices are high. If you‚Äôve got time, set a price alert and wait for a better deal.'
  }
}

      };
      
      const category = meetsStandards ? 'good' : 'bad';
      return recommendations[category][cppTier];
    }

    const elements = {
      origin: document.getElementById('origin'),
      destination: document.getElementById('destination'),
      fareClass: document.getElementById('fareClass'),
      points: document.getElementById('points'),
      taxes: document.getElementById('taxes'),
      cashPrice: document.getElementById('cashPrice'),
      form: document.getElementById('combinedForm'),
      resultsGrid: document.getElementById('resultsGrid'),
      dealCard: document.getElementById('dealQualityCard'),
      dealStatus: document.getElementById('dealStatus'),
      dealDetails: document.getElementById('dealDetails'),
      cppValue: document.getElementById('cppValue'),
      cppRating: document.getElementById('cppRating'),
      recommendation: document.getElementById('recommendation')
    };

    elements.origin.addEventListener('input', () => {
      elements.origin.value = elements.origin.value.replace(/[^a-zA-Z]/g, "").toUpperCase().slice(0, 3);
    });

    attachNumberFormatter(elements.points, false);
    attachNumberFormatter(elements.taxes, true);
    attachNumberFormatter(elements.cashPrice, true);

    elements.form.addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = {
        origin: elements.origin.value.toUpperCase(),
        destination: elements.destination.value,
        fareClass: elements.fareClass.value,
        points: parseInt(parseFormattedNumber(elements.points.value), 10),
        taxes: parseFloat(parseFormattedNumber(elements.taxes.value)),
        cashPrice: elements.cashPrice.value.trim() 
          ? parseFloat(parseFormattedNumber(elements.cashPrice.value)) 
          : NaN
      };

      const airportSize = getAirportSize(formData.origin);
      if (!airportSize) {
        alert('Please enter a valid US airport code.');
        return;
      }
      
      if (!Number.isFinite(formData.points) || formData.points <= 0) {
        alert('Please enter a valid Points value.');
        return;
      }
      
      if (!Number.isFinite(formData.taxes) || formData.taxes < 0) {
        alert('Please enter a valid Taxes & Fees amount.');
        return;
      }

      const maxPoints = CONFIG.pointLimits[airportSize][formData.destination][formData.fareClass];
      const taxCap = CONFIG.taxCaps[formData.fareClass];
      const meetsStandards = formData.points <= maxPoints && formData.taxes <= taxCap;

      elements.dealCard.className = `result-card deal-quality ${meetsStandards ? 'good' : 'bad'}`;
      elements.dealStatus.textContent = meetsStandards ? '‚úÖ GOOD' : '‚ùå POOR';
      elements.dealDetails.textContent = '';

      let recommendationText, recommendationClass;
      
      if (Number.isFinite(formData.cashPrice) && formData.cashPrice > 0) {
        const cpp = ((formData.cashPrice - formData.taxes) / formData.points) * 100;
        const cppTier = getCppTier(cpp);
        
        elements.cppValue.textContent = cpp.toFixed(2) + '¬¢';
        elements.cppRating.textContent = '';
        
const highTaxes = formData.taxes > taxCap;        
        const rec = getRecommendation(meetsStandards, cppTier, highTaxes);
        recommendationClass = rec.class;
        recommendationText = rec.text;
      } else {
        elements.cppValue.textContent = '‚Äî';
        elements.cppRating.textContent = 'Add a cash price to calculate cents per point';
        
        if (meetsStandards) {
          recommendationClass = 'yes';
          recommendationText = 'üíé <strong>Great use of points.</strong> Just add in the cash fare price to make sure you\'re getting the best value.';
        } else {
          const taxExceedsCap = formData.taxes > taxCap;
          const pointsExceedLimit = formData.points > maxPoints;
          
          recommendationClass = 'no';
          if (taxExceedsCap && !pointsExceedLimit) {
            recommendationText = 'üí∞ <strong>Taxes kill the deal.</strong> Taxes are higher than usual for this redemption. Enter the cash fare to see if paying out of pocket gives you a better deal.';
          } else {
            recommendationText = 'üö´ <strong>Not worth your points.</strong> The redemption rate isn\'t great. You can get way more value elsewhere.\n\nCheck out our current live points deals to see how far your points can go, or check if you should book with cash.';
          }
        }
      }

      elements.recommendation.className = `recommendation ${recommendationClass}`;
      elements.recommendation.innerHTML = recommendationText;

      elements.resultsGrid.style.display = 'grid';
      elements.recommendation.style.display = 'block';
    });
  </script>
</body>
</html>
